From 27cf183e55cd68e4871096c90e1417c769727be1 Mon Sep 17 00:00:00 2001
From: Quanyang Wang <quanyang.wang@windriver.com>
Date: Thu, 23 Sep 2021 09:56:14 +0800
Subject: [PATCH] axxia: lowlevel: ensure CVE-2017-5715 cover all cores

The label "set_actlr" should be behind "set_actlr2", or else
only 0, 4, 8, 12 cores enable invalidates of BTB.

Upstream-Status: Committed

Signed-off-by: Quanyang Wang <quanyang.wang@windriver.com>
---
 board/lsi/axxia-arm/lowlevel.S | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/board/lsi/axxia-arm/lowlevel.S b/board/lsi/axxia-arm/lowlevel.S
index 76418d5b6c..85df33cc23 100644
--- a/board/lsi/axxia-arm/lowlevel.S
+++ b/board/lsi/axxia-arm/lowlevel.S
@@ -505,6 +505,15 @@ wa_811981_stuck:
 
 wa_811981_okay:
 
+	@@
+	@ Iniitalize the ACTLR2 register (all cores).
+
+set_actlr2:
+
+	mrc 	p15, 1, r0, c15, c0, 4
+	orr 	r0, r0, #(1 << 0)
+	mcr 	p15, 1, r0, c15, c0, 4
+
 	@@
 	@ Iniitalize the ACTLR register (all cores).
 
@@ -518,15 +527,6 @@ set_actlr:
 	mcr 	p15, 0, r0, c1, c0, 1
 #endif /* CVE_2017_5715 */
 
-	@@
-	@ Iniitalize the ACTLR2 register (all cores).
-
-set_actlr2:
-
-	mrc 	p15, 1, r0, c15, c0, 4
-	orr 	r0, r0, #(1 << 0)
-	mcr 	p15, 1, r0, c15, c0, 4
-
 #ifndef CONFIG_SPL_BUILD
 
 	@@
-- 
2.25.1

